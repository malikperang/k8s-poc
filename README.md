# Kubernetes Proof of Concept with Vagrant.

## VM Specifications

- Ubuntu 18.04
- 2 Core CPU's
- 4GB RAM on Master node
- 2GB Ram on Worker's node

## Tools Required

- Vagrant
- Docker
- Kubeadm
- Calico

This POC consists of three nodes setup.

# Usage

### Initialize server

1. Run up_server.sh
   ```
   $ ./up_server.sh
   ```

### Initialize Kubernetes

1. Navigate inside **svr-master1** and ssh into k8s-master.
   ```
   $ cd svr-master1
   $ vagrant ssh
   ```
2. Initialize k8s using **kubeadm** command

   ```
   $ sudo kubeadm init --apiserver-advertise-address=192.168.30.30 --apiserver-cert-extra-sans=192.168.30.30 --node-name k8s-master --pod-network-cidr=192.168.0.0/16`
   ```

   if you found swap was still not off, run

   ```
   $ sudo swapoff -a
   ```

   Copy the connection string generated by kubeadm to use later on worker nodes.

   Copy kubectl config to .kube directory,run

   ```
   $ mkdir -p $HOME/.kube
   $ sudo cp /etc/kubernetes/admin.conf /.kube/config
   $ sudo chown $(id -u):$(id -g) $HOME/.kube/config
   ```

3. Install Calico

   ```
   $ kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
   $ kubectl taint nodes --all node-role.kubernetes.io/master-
   ```

   Confirm node are running in a cluster

   ```
   $ kubectl get nodes -o wide
   ```

4. Adding worker1 & worker2 nodes to cluster. Ensure that you copy the token before.

   ```
   On k8s-worker1 server
   $ cd svr-worker1
   $ vagrant ssh
   $ kubeadm join 192.168.30.30:6443 --token s7qgbz.c2zcrd8f8hn5aqgv \
    --discovery-token-ca-cert-hash sha256:<token>

   On k8s-worker2 server
   $ cd svr-worker2
   $ vagrant ssh
   $ kubeadm join 192.168.30.30:6443 --token s7qgbz.c2zcrd8f8hn5aqgv \
    --discovery-token-ca-cert-hash sha256:<token>
   ```

5. Verify worker1 and worker2 node connected with cluster
   ```
   $ cd svr-master1
   $ vagrant ssh
   $ kubectl get nodes -o wide
   ```

## Halt server

1. Run

   ```
   $ ./halt_server.sh
   ```

## Destroy server

1. Run
   ```
   $ ./destroy.sh
   ```

## Authors

- **Fariz Izwan** - [Github](https://github.com/malikperang)
